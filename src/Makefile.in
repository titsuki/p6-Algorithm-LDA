name = %lda%
SRCS = lda.c theta.c document.c util.c path.c phi.c
OBJS = $(SRCS:.c=.o)
HEADERS	= $(SRCS:.c=.h)

ifeq ($(OS),Windows_NT)
	detected_OS := Windows
else
	detected_OS := $(shell uname)
endif

ifeq ($(detected_OS), Linux)
	LDFLAGS += -lm
endif

all: %DESTDIR%/resources/libraries/%lda%

clean:
	rm %DESTDIR%/resources/libraries/%lda%

%DESTDIR%/resources/libraries/%lda%: $(OBJS)
	%CC% -std=c99 -shared %CCSHARED% %CCFLAGS% $(OBJS) -o $@ $(LDFLAGS)

%.o: %.c %.h
	%CC% -std=c99 -shared %CCSHARED% %CCFLAGS% -c $< $(LDFLAGS)

%.d: %.c
	@set -e; rm -f $@; \
	%CC% -std=c99 -M %CCFLAGS% $< > $@.$$$$; \
	sed 's,\($*\)\.o[ :]*,\1.o $@ : ,g' < $@.$$$$ > $@; \
	rm -f $@.$$$$

-include $(SRCS:.c=.d)
